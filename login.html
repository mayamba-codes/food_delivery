<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - FoodExpress</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="../index.php" class="logo">
                <i class="fas fa-utensils"></i>
                <span>FoodExpress</span>
            </a>
            
            <div class="nav-links">
                <a href="../index.php"><i class="fas fa-home"></i> Home</a>
                <a href="menu.html"><i class="fas fa-utensils"></i> Menu</a>
                <a href="cart.html"><i class="fas fa-shopping-cart"></i> Cart</a>
                <a href="login.html" class="active"><i class="fas fa-sign-in-alt"></i> Login</a>
                <a href="register.html"><i class="fas fa-user-plus"></i> Register</a>
            </div>
            
            <button class="menu-toggle" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- Login Section -->
    <section class="auth-section">
        <div class="container">
            <div class="auth-container">
                <div class="auth-header">
                    <h1>Welcome Back!</h1>
                    <p>Sign in to your FoodExpress account</p>
                </div>
                
                <form id="login-form" class="auth-form">
                    <div class="form-group">
                        <label for="username">
                            <i class="fas fa-user"></i> Username or Email
                        </label>
                        <input type="text" id="username" name="username" required 
                               placeholder="Enter your username or email">
                        <div class="error-message" id="username-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">
                            <i class="fas fa-lock"></i> Password
                        </label>
                        <input type="password" id="password" name="password" required 
                               placeholder="Enter your password">
                        <div class="error-message" id="password-error"></div>
                    </div>
                    
                    <div class="form-options">
                        <label class="checkbox">
                            <input type="checkbox" id="remember-me">
                            <span>Remember me</span>
                        </label>
                        <a href="#" class="forgot-password">Forgot Password?</a>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                    
                    <div class="auth-divider">
                        <span>or</span>
                    </div>
                    
                    <div class="auth-footer">
                        <p>Don't have an account? <a href="register.html">Register here</a></p>
                        <a href="../index.php" class="btn btn-outline btn-block">
                            <i class="fas fa-home"></i> Back to Home
                        </a>
                    </div>
                </form>
                
                <div class="auth-info">
                    <div class="info-card">
                        <i class="fas fa-shield-alt"></i>
                        <h3>Secure Login</h3>
                        <p>Your information is protected with 256-bit encryption</p>
                    </div>
                    <div class="info-card">
                        <i class="fas fa-bolt"></i>
                        <h3>Quick Access</h3>
                        <p>Access your order history and favorite items instantly</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>FoodExpress</h3>
                    <p>Delivering happiness since 2024</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <a href="../index.php">Home</a>
                    <a href="menu.html">Menu</a>
                    <a href="#">About Us</a>
                    <a href="#">Contact</a>
                </div>
                <div class="footer-section">
                    <h4>Contact Us</h4>
                    <p><i class="fas fa-phone"></i> +1 (555) 123-4567</p>
                    <p><i class="fas fa-envelope"></i> support@foodexpress.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 FoodExpress. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="../assets/js/main.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const loginForm = document.getElementById('login-form');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        
        // Initialize mobile menu
        const menuToggle = document.getElementById('menu-toggle');
        const navLinks = document.querySelector('.nav-links');
        
        if (menuToggle && navLinks) {
            menuToggle.addEventListener('click', function() {
                navLinks.classList.toggle('active');
            });
        }
        
        // Check if already logged in
        checkExistingSession();
        
        // Validate form on submit
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Clear previous errors
            clearErrors();
            
            // Validate inputs
            let isValid = true;
            
            if (!usernameInput.value.trim()) {
                showError('username-error', 'Username or email is required');
                isValid = false;
            }
            
            if (!passwordInput.value.trim()) {
                showError('password-error', 'Password is required');
                isValid = false;
            } else if (passwordInput.value.length < 6) {
                showError('password-error', 'Password must be at least 6 characters');
                isValid = false;
            }
            
            if (isValid) {
                loginUser();
            }
        });
        
        function checkExistingSession() {
            fetch('../backend/api/auth.php?action=check')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.data && data.data.logged_in) {
                        // Already logged in, redirect
                        if (data.data.role_id == 1) {
                            window.location.href = '../admin/dashboard.php';
                        } else {
                            window.location.href = 'menu.html';
                        }
                    }
                })
                .catch(error => console.error('Error checking session:', error));
        }
        
        function loginUser() {
            const submitBtn = loginForm.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
            submitBtn.disabled = true;
            
            const formData = {
                username: usernameInput.value.trim(),
                password: passwordInput.value
            };
            
            console.log('Sending login request with:', { username: formData.username });
            
            // IMPORTANT: Use URL with action parameter
            fetch('../backend/api/auth.php?action=login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Login response:', data);
                
                if (data.success) {
                    // Show success message
                    showNotification('Login successful! Redirecting...', 'success');
                    
                    // Store remember me preference
                    const rememberMe = document.getElementById('remember-me').checked;
                    if (rememberMe) {
                        localStorage.setItem('rememberUsername', usernameInput.value.trim());
                    } else {
                        localStorage.removeItem('rememberUsername');
                    }
                    
                    // Store user data in localStorage for quick access
                    if (data.data) {
                        localStorage.setItem('user_id', data.data.user_id);
                        localStorage.setItem('username', data.data.username);
                        localStorage.setItem('full_name', data.data.full_name);
                        localStorage.setItem('role_id', data.data.role_id);
                    }
                    
                    // Redirect based on role
                    setTimeout(() => {
                        if (data.data && data.data.role_id == 1) {
                            // Admin
                            window.location.href = '../admin/dashboard.php';
                        } else {
                            // Customer
                            window.location.href = 'menu.html';
                        }
                    }, 1500);
                } else {
                    showNotification(data.message || 'Login failed', 'error');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            })
            .catch(error => {
                console.error('Fetch Error:', error);
                showNotification('Connection error. Please check if XAMPP/WAMP is running.', 'error');
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        }
        
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            }
        }
        
        function clearErrors() {
            document.querySelectorAll('.error-message').forEach(element => {
                element.textContent = '';
                element.style.display = 'none';
            });
        }
        
        function showNotification(message, type = 'info') {
            // Simple alert for now - you can enhance this
            alert(message);
        }
        
        // Check for remembered username
        const rememberedUsername = localStorage.getItem('rememberUsername');
        if (rememberedUsername) {
            usernameInput.value = rememberedUsername;
            document.getElementById('remember-me').checked = true;
        }
    });
       /* document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.getElementById('login-form');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            
            // Initialize mobile menu
            const menuToggle = document.getElementById('menu-toggle');
            const navLinks = document.querySelector('.nav-links');
            
            if (menuToggle && navLinks) {
                menuToggle.addEventListener('click', function() {
                    navLinks.classList.toggle('active');
                });
            }
            
            // Validate form on submit
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Clear previous errors
                clearErrors();
                
                // Validate inputs
                let isValid = true;
                
                if (!usernameInput.value.trim()) {
                    showError('username-error', 'Username or email is required');
                    isValid = false;
                }
                
                if (!passwordInput.value.trim()) {
                    showError('password-error', 'Password is required');
                    isValid = false;
                } else if (passwordInput.value.length < 6) {
                    showError('password-error', 'Password must be at least 6 characters');
                    isValid = false;
                }
                
                if (isValid) {
                    loginUser();
                }
            });
            
            function loginUser() {
                const submitBtn = loginForm.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
                submitBtn.disabled = true;
                
                const formData = {
                    username: usernameInput.value.trim(),
                    password: passwordInput.value
                };
                
                fetch('../backend/api/auth.php?action=login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Show success message
                        showNotification('Login successful! Redirecting...', 'success'
                        );
                        
                        // Store remember me preference
                        const rememberMe = document.getElementById('remember-me').checked;
                        if (rememberMe) {
                            localStorage.setItem('rememberUsername', usernameInput.value.trim());
                        } else {
                            localStorage.removeItem('rememberUsername');
                        }
                        
                        // Redirect based on role
                        setTimeout(() => {
                            if (data.data.role_id == 1) {
                                // Admin
                                window.location.href = '../admin/dashboard.php';
                            } else {
                                // Customer
                                window.location.href = 'menu.html';
                            }
                        }, 1500);
                    } else {
                        showNotification(data.message || 'Login failed', 'error');
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('An error occurred. Please try again.', 'error');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                });
            }
            
            function showError(elementId, message) {
                const errorElement = document.getElementById(elementId);
                if (errorElement) {
                    errorElement.textContent = message;
                    errorElement.style.display = 'block';
                }
            }
            
            function clearErrors() {
                document.querySelectorAll('.error-message').forEach(element => {
                    element.textContent = '';
                    element.style.display = 'none';
                });
            }
            
            // Check for remembered username
            const rememberedUsername = localStorage.getItem('rememberUsername');
            if (rememberedUsername) {
                usernameInput.value = rememberedUsername;
                document.getElementById('remember-me').checked = true;
            }
        });
        */
        // Add styles for login page
        const style = document.createElement('style');
        style.textContent = `
            .auth-section {
                min-height: calc(100vh - 200px);
                display: flex;
                align-items: center;
                padding: 60px 0;
                background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            }
            
            .auth-container {
                max-width: 500px;
                margin: 0 auto;
                background: white;
                border-radius: 15px;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
                overflow: hidden;
            }
            
            .auth-header {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 40px 30px;
                text-align: center;
            }
            
            .auth-header h1 {
                margin: 0 0 10px 0;
                font-size: 2.5rem;
            }
            
            .auth-header p {
                opacity: 0.9;
                margin: 0;
            }
            
            .auth-form {
                padding: 30px;
            }
            
            .form-group {
                margin-bottom: 25px;
            }
            
            .form-group label {
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 8px;
                font-weight: 500;
                color: #333;
            }
            
            .form-group label i {
            color: #667eea;
            }
            
            .form-group input {
                width: 100%;
                padding: 12px 15px;
                border: 2px solid #e0e0e0;
                border-radius: 8px;
                font-size: 1rem;
                transition: all 0.3s;
            }
            
            .form-group input:focus {
                outline: none;
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }
            
            .error-message {
                color: #e74c3c;
                font-size: 0.875rem;
                margin-top: 5px;
                display: none;
            }
            
            .form-options {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 25px;
            }
            
            .checkbox {
                display: flex;
                align-items: center;
                gap: 8px;
                cursor: pointer;
            }
            
            .checkbox input[type="checkbox"] {
                width: auto;
            }
            
            .forgot-password {
                color: #667eea;
                text-decoration: none;
                font-size: 0.9rem;
            }
            
            .forgot-password:hover {
                text-decoration: underline;
            }
            
            .btn-block {
                width: 100%;
            }
            
            .auth-divider {
                display: flex;
                align-items: center;
                margin: 25px 0;
                color: #666;
            }
            
            .auth-divider::before,
            .auth-divider::after {
                content: '';
                flex: 1;
                height: 1px;
                background: #e0e0e0;
            }
            
            .auth-divider span {
                padding: 0 15px;
            }
            
            .auth-footer {
                text-align: center;
                margin-top: 20px;
            }
            
            .auth-footer p {
                margin-bottom: 15px;
                color: #666;
            }
            
            .auth-footer a {
                color: #667eea;
                text-decoration: none;
                font-weight: 500;
            }
            
            .auth-footer a:hover {
                text-decoration: underline;
            }
            
            .auth-info {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
                padding: 30px;
                background: #f8f9fa;
                border-top: 1px solid #e0e0e0;
            }
            
            .info-card {
                text-align: center;
                padding: 20px;
                background: white;
                border-radius: 10px;
                box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            }
            
            .info-card i {
                font-size: 2rem;
                color: #667eea;
                margin-bottom: 15px;
            }
            
            .info-card h3 {
                margin: 0 0 10px 0;
                font-size: 1.1rem;
                color: #333;
            }
            
            .info-card p {
                margin: 0;
                font-size: 0.9rem;
                color: #666;
                line-height: 1.4;
            }
            
            @media (max-width: 768px) {
                .auth-container {
                    margin: 20px;
                }
                
                .auth-info {
                    grid-template-columns: 1fr;
                }
                
                .auth-header {
                    padding: 30px 20px;
                }
                
                .auth-header h1 {
                    font-size: 2rem;
                }
                    .auth-form {
                    padding: 20px;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>