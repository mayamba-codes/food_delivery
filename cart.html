<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Cart - FoodExpress</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="../index.php" class="logo">
                <i class="fas fa-utensils"></i>
                <span>FoodExpress</span>
            </a>
            
            <div class="nav-links">
                <a href="../index.php"><i class="fas fa-home"></i> Home</a>
                <a href="menu.html"><i class="fas fa-utensils"></i> Menu</a>
                <a href="cart.html" class="active"><i class="fas fa-shopping-cart"></i> Cart <span id="cart-count" class="cart-count">0</span></a>
                <a href="order-history.html"><i class="fas fa-history"></i> Orders</a>
                <div class="user-menu" id="user-menu" style="display: none;">
                    <div class="user-dropdown">
                        <button class="user-btn">
                            <i class="fas fa-user-circle"></i>
                            <span id="username-display"></span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown-content">
                            <a href="#"><i class="fas fa-user"></i> Profile</a>
                            <a href="order-history.html"><i class="fas fa-history"></i> Order History</a>
                            <a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="menu-toggle" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- Cart Section -->
    <section class="cart-section">
        <div class="container">
            <div class="cart-header">
                <h1><i class="fas fa-shopping-cart"></i> Shopping Cart</h1>
                <p id="cart-summary">0 items in your cart</p>
            </div>
            
            <div class="cart-content">
                <div class="cart-items" id="cart-items-container">
                    <!-- Cart items will be loaded here -->
                    <div class="empty-cart" id="empty-cart">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>Your cart is empty</h3>
                        <p>Add delicious food items from our menu</p>
                        <a href="menu.html" class="btn btn-primary">
                            <i class="fas fa-utensils"></i> Browse Menu
                        </a>
                    </div>
                </div>
                
                <div class="cart-summary" id="cart-summary-container">
                    <div class="summary-card">
                        <h3>Order Summary</h3>
                        
                        <div class="summary-details">
                            <div class="summary-row">
                                <span>Subtotal</span>
                                <span id="subtotal">$0.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Delivery Fee</span>
                                <span id="delivery-fee">$2.99</span>
                            </div>
                            <div class="summary-row">
                                <span>Tax (8%)</span>
                                <span id="tax">$0.00</span>
                            </div>
                            <div class="summary-row total">
                                <span>Total</span>
                                <span id="total">$0.00</span>
                            </div>
                         </div>
                        
                        <div class="promo-code">
                            <input type="text" id="promo-code" placeholder="Enter promo code">
                            <button id="apply-promo" class="btn btn-outline">Apply</button>
                        </div>
                        
                        <div class="delivery-info">
                            <h4><i class="fas fa-truck"></i> Delivery Information</h4>
                            <p id="delivery-address">Add delivery address</p>
                            <button id="change-address" class="btn btn-text">Change</button>
                        </div>
                        
                        <button id="checkout-btn" class="btn btn-primary btn-block" disabled>
                            <i class="fas fa-lock"></i> Proceed to Checkout
                        </button>
                        
                        <div class="secure-checkout">
                            <i class="fas fa-shield-alt"></i>
                            <span>Secure checkout Â· Your payment is protected</span>
                        </div>
                    </div>
                    
                    <div class="cart-actions">
                        <a href="menu.html" class="btn btn-outline">
                            <i class="fas fa-arrow-left"></i> Continue Shopping
                        </a>
                        <button id="clear-cart" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Clear Cart
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>FoodExpress</h3>
                    <p>Delivering happiness since 2024</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <a href="../index.php">Home</a>
                    <a href="menu.html">Menu</a>
                    <a href="#">About Us</a>
                    <a href="#">Contact</a>
                </div>
                <div class="footer-section">
                    <h4>Contact Us</h4>
                    <p><i class="fas fa-phone"></i> +1 (555) 123-4567</p>
                    <p><i class="fas fa-envelope"></i> support@foodexpress.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 FoodExpress. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="../assets/js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check login status
            checkLoginStatus();
            loadCartItems();
            
            // Initialize mobile menu
            const menuToggle = document.getElementById('menu-toggle');
            const navLinks = document.querySelector('.nav-links');
            
            if (menuToggle && navLinks) {
                menuToggle.addEventListener('click', function() {
                    navLinks.classList.toggle('active');
                });
            }
            
            // Event listeners
            document.getElementById('checkout-btn').addEventListener('click', function() {
                if (!checkLoginStatus(true)) return;
                window.location.href = 'checkout.html';
            });
            
            document.getElementById('clear-cart').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear your cart?')) {
                    clearCart();
                }
            });
            
            document.getElementById('apply-promo').addEventListener('click', function() {
                const promoCode = document.getElementById('promo-code').value.trim();
                if (promoCode) {
                       applyPromoCode(promoCode);
                }
            });
            
            document.getElementById('change-address').addEventListener('click', function() {
                // In a real implementation, this would open an address form
                promptForAddress();
            });
        });
        
        function loadCartItems() {
            fetch('../backend/api/cart.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateCartDisplay(data.data);
                    } else {
                        // User not logged in or cart empty
                        if (data.message === 'Please login first') {
                            showNotification('Please login to view your cart', 'warning');
                            setTimeout(() => {
                                window.location.href = 'login.html';
                            }, 2000);
                        }
                        updateCartDisplay({ items: [], total: 0, count: 0 });
                    }
                })
                .catch(error => {
                    console.error('Error loading cart:', error);
                    updateCartDisplay({ items: [], total: 0, count: 0 });
                });
        }
        
        function updateCartDisplay(cartData) {
            const container = document.getElementById('cart-items-container');
            const emptyCart = document.getElementById('empty-cart');
            const summaryContainer = document.getElementById('cart-summary-container');
            const cartCount = document.getElementById('cart-count');
            const checkoutBtn = document.getElementById('checkout-btn');
            
            if (cartData.count > 0) {
                // Show cart items
                emptyCart.style.display = 'none';
                summaryContainer.style.display = 'block';
                
                // Update cart count
                cartCount.textContent = cartData.count;
                cartCount.style.display = 'inline-flex';
                
                // Enable checkout button
                checkoutBtn.disabled = false;
                
                // Render cart items
                container.innerHTML = cartData.items.map(item => `
                    <div class="cart-item" data-cart-id="${item.cart_id}">
                        <div class="cart-item-image">
                            <img src="${item.image_url || '../assets/images/default-food.jpg'}" 
                                 alt="${item.food_name}"
                                 onerror="this.src='../assets/images/default-food.jpg'">
                        </div>
                        <div class="cart-item-details">
                            <h3>${item.food_name}</h3>
                            <p class="item-description">${item.description || 'Delicious food item'}</p>
                            <div class="item-price">$${parseFloat(item.price).toFixed(2)} each</div>
                        </div>
                        <div class="cart-item-quantity">
                            <button class="quantity-btn minus" onclick="updateQuantity(${item.cart_id}, ${item.quantity - 1})">
                                <i class="fas fa-minus"></i>
                            </button>
                            <input type="number" class="quantity-input" 
                                   value="${item.quantity}" min="1" max="10"
                                   onchange="updateQuantity(${item.cart_id}, this.value)">
                            <button class="quantity-btn plus" onclick="updateQuantity(${item.cart_id}, ${item.quantity + 1})">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="cart-item-subtotal">
                            <span>$${(item.subtotal || item.price * item.quantity).toFixed(2)}</span>
                        </div>
                        <div class="cart-item-remove">
                            <button class="remove-btn" onclick="removeFromCart(${item.cart_id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
                
                // Update summary
                updateSummary(cartData.total);
            } else {
                // Show empty cart
                emptyCart.style.display = 'flex';
                summaryContainer.style.display = 'none';
                cartCount.style.display = 'none';
                checkoutBtn.disabled = true;
            }
        }
        
        function updateQuantity(cartId, newQuantity) {
            if (newQuantity < 1) newQuantity = 1;
            if (newQuantity > 10) newQuantity = 10;
            
            fetch('../backend/api/cart.php?action=update', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ cart_id: cartId, quantity: newQuantity })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    loadCartItems();
                    updateCartCount();
                } else {
                    showNotification(data.message || 'Failed to update quantity', 'error');
                }
            })
            .catch(error => {
                console.error('Error updating quantity:', error);
                showNotification('Failed to update quantity', 'error');
            });
        }
        
        function removeFromCart(cartId) {
            if (confirm('Remove this item from cart?')) {
                fetch('../backend/api/cart.php?cart_id=${cartId}', {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification('Item removed from cart', 'success');
                        loadCartItems();
                        updateCartCount();
                    } else {
                        showNotification(data.message || 'Failed to remove item', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error removing item:', error);
                    showNotification('Failed to remove item', 'error');
                });
            }
        }
        
        function clearCart() {
            fetch('../backend/api/cart.php?action=clear', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Cart cleared', 'success');
                    loadCartItems();
                    updateCartCount();
                } else {
                    showNotification(data.message || 'Failed to clear cart', 'error');
                }
            })
            .catch(error => {
                console.error('Error clearing cart:', error);
                showNotification('Failed to clear cart', 'error');
            });
        }
        
        function updateSummary(subtotal) {
            const deliveryFee = 2.99;
            const tax = subtotal * 0.08;
            const total = subtotal + deliveryFee + tax;
            
            document.getElementById('subtotal').textContent = '$' + subtotal.toFixed(2);
            document.getElementById('tax').textContent = '$' + tax.toFixed(2);
            document.getElementById('total').textContent = '$' + total.toFixed(2);
            
            // Update cart summary text
            const itemCount = 
            document.querySelectorAll('.cart-item').length;
            document.getElementById('cart-summary').textContent = 
                `${itemCount} item${itemCount !== 1 ? 's' : ''} in your cart`;
        }
        function applyPromoCode(promoCode) {
            // Simple promo code validation
            const validPromoCodes = {
                'WELCOME10': 0.10,  // 10% off
                'SAVE5': 0.05,      // 5% off
                'FREEDELIVERY': 'free_delivery'
            };
            
            if (validPromoCodes[promoCode.toUpperCase()]) {
                showNotification('Promo code applied!', 'success');
                // In a real implementation, you would apply the discount
                // and recalculate the total
            } else {
                showNotification('Invalid promo code', 'error');
            }
        }
        
        function promptForAddress() {
            const address = prompt('Enter your delivery address:');
            if (address && address.trim()) {
                document.getElementById('delivery-address').textContent = address;
            }
        }
        
        // Add styles for cart page
        const style = document.createElement('style');
        style.textContent = `
            .cart-section {
                padding: 40px 0 80px;
                min-height: calc(100vh - 200px);
                background: #f8f9fa;
            }
            
            .cart-header {
                text-align: center;
                margin-bottom: 40px;
            }
            
            .cart-header h1 {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 15px;
                margin-bottom: 10px;
                color: #333;
            }
            
            .cart-header p {
                color: #666;
                font-size: 1.1rem;
            }
            
            .cart-content {
                display: grid;
                grid-template-columns: 1fr 350px;
                gap: 30px;
            }
            
            .cart-items {
                background: white;
                border-radius: 10px;
                padding: 20px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            }
            
            .empty-cart {
                display: none;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 60px 20px;
                text-align: center;
            }
            
            .empty-cart i {
                font-size: 4rem;
                color: #ddd;
                margin-bottom: 20px;
            }
            
            .empty-cart h3 {
                margin: 0 0 10px 0;
                color: #666;
            }
            
            .empty-cart p {
                margin: 0 0 20px 0;
                color: #999;
            }
            
            .cart-item {
                display: grid;
                grid-template-columns: 100px 1fr 150px 100px 50px;
                gap: 20px;
                padding: 20px;
                border-bottom: 1px solid #eee;
                align-items: center;
            }
            
            .cart-item:last-child {
                border-bottom: none;
            }
            
            .cart-item-image {
                width: 100px;
                height: 100px;
                border-radius: 8px;
                overflow: hidden;
            }
            
            .cart-item-image img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            .cart-item-details h3 {
                margin: 0 0 5px 0;
                font-size: 1.1rem;
                color: #333;
            }
            
            .item-description {
                margin: 0 0 10px 0;
                color: #666;
                font-size: 0.9rem;
                line-height: 1.4;
            }
            
            .item-price {
                font-weight: 600;
                color: #ff6b6b;
            }
            
            .cart-item-quantity {
                display: flex;
                align-items: center;
                gap: 10px;
            }
            
            .quantity-btn {
                width: 35px;
                height: 35px;
                border: 2px solid #e0e0e0;
                background: white;
                border-radius: 5px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s;
            }
            
            .quantity-btn:hover {
                border-color: #ff6b6b;
                color: #ff6b6b;
            }
            
            .quantity-input {
                width: 50px;
                height: 35px;
                border: 2px solid #e0e0e0;
                border-radius: 5px;
                text-align: center;
                font-size: 1rem;
            }
            
            .quantity-input:focus {
                outline: none;
                border-color: #ff6b6b;
            }
            
            .cart-item-subtotal {
                font-weight: 700;
                font-size: 1.1rem;
                color: #333;
                text-align: right;
            }
            
            .cart-item-remove .remove-btn {
                background: none;
                border: none;
                color: #e74c3c;
                cursor: pointer;
                font-size: 1.1rem;
                transition: color 0.3s;
            }
            
            .cart-item-remove .remove-btn:hover {
                color: #c0392b;
            }
            
            .cart-summary {
                position: sticky;
                top: 100px;
            }
            
            .summary-card {
                background: white;
                border-radius: 10px;
                padding: 25px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
                margin-bottom: 20px;
            }
            
            .summary-card h3 {
                margin: 0 0 20px 0;
                padding-bottom: 15px;
                border-bottom: 2px solid #f8f9fa;
                color: #333;
            }
            
            .summary-details {
                margin-bottom: 20px;
            }
            
            .summary-row {
                display: flex;
                justify-content: space-between;
                margin-bottom: 10px;
                color: #666;
            }
            
            .summary-row.total {
                font-weight: 700;
                font-size: 1.2rem;
                color: #333;
                margin-top: 15px;
                padding-top: 15px;
                border-top: 2px solid #f8f9fa;
            }
            
            .promo-code {
                display: flex;
                gap: 10px;
                margin-bottom: 20px;
            }
            
            .promo-code input {
                flex: 1;
                padding: 10px 15px;
                border: 2px solid #e0e0e0;
                border-radius: 5px;
                font-size: 0.9rem;
            }
            
            .promo-code input:focus {
                outline: none;
                border-color: #ff6b6b;
            }
            
            .delivery-info {
                background: #f8f9fa;
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 20px;
            }
            
            .delivery-info h4 {
                display: flex;
                align-items: center;
                gap: 10px;
                margin: 0 0 10px 0;
                font-size: 1rem;
                color: #333;
            }
            
            .delivery-info p {
                margin: 0 0 10px 0;
                color: #666;
                font-size: 0.9rem;
                line-height: 1.4;
            }
            
            .btn-text {
                background: none;
                border: none;
                color: #ff6b6b;
                cursor: pointer;
                padding: 0;
                font-size: 0.9rem;
                text-decoration: underline;
            }
            
            .secure-checkout {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                margin-top: 15px;
                color: #666;
                font-size: 0.9rem;
            }
            
            .secure-checkout i {
                color: #4CAF50;
            }
            
            .cart-actions {
                display: flex;
                gap: 15px;
            }
            
            .cart-actions .btn {
                flex: 1;
            }
            
            .btn-danger {
                background-color: #e74c3c;
                color: white;
                border: none;
            }
            
            .btn-danger:hover {
                background-color: #c0392b;
            }
            
            @media (max-width: 992px) {
                .cart-content {
                    grid-template-columns: 1fr;
                }
                
                .cart-summary {
                    position: static;
                }
            }
            
            @media (max-width: 768px) {
                .cart-item {
                    grid-template-columns: 80px 1fr;
                    grid-template-rows: auto auto auto;
                    gap: 15px;
                }
                
                .cart-item-image {
                    grid-row: 1 / 2;
                }
                
                .cart-item-details {
                    grid-row: 1 / 2;
                }
                
                .cart-item-quantity {
                    grid-row: 2 / 3;
                    grid-column: 1 / 3;
                    justify-content: center;
                }
                
                .cart-item-subtotal {
                    grid-row: 3 / 4;
                    grid-column: 1 / 2;
                    text-align: left;
                }
                
                .cart-item-remove {
                    grid-row: 3 / 4;
                    grid-column: 2 / 3;
                    text-align: right;
                }
                
                .cart-actions {
                    flex-direction: column;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>